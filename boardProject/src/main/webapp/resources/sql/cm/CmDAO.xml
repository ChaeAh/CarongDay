<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.boardproject.cm.service.impl.CmDAO">
 
	<!-- property : vo에서 변수명.  column : DB상 컬럼명  -->
	 <resultMap id="BoardVOarr" type="BoardVO">
	 	<result property="idx" column="idx"/>
	 	<result property="boardId" column="BOARD_ID"/>
	 	<result property="title" column="TITLE"/>
	 	<result property="contents" column="CONTENTS"/> 	
	 	<result property="delYn" column="DEL_YN"/>
	 	<result property="atchYn" column="ATCH_YN"/>
	 	<result property="readCnt" column="READ_CNT"/> 	
	 	<result property="rgtId" column="RGTR_ID"/>
	 	<result property="rgtDtm" column="RGT_DTM"/>
	 	<result property="updId" column="UPDR_ID"/>
	 	<result property="updDtm" column="UPD_DTM"/>
	 	<result property="scrYn" column="SCR_YN"/>
	 	<result property="scrPw" column="SCR_PW"/>
	 </resultMap>
	 
	  <resultMap id="CmCodearr" type="CmVO">
	 	<result property="cdId" column="cd_id"/>
	 	<result property="gnrCd" column="gnr_cd"/>
	 	<result property="gnrCdNm" column="gnr_cd_nm"/>
	 	<result property="cdCts" column="cd_cts"/>
	 	<result property="cdPrps" column="cd_prps"/> 	
	 	<result property="useYn" column="use_yn"/>
	 	<result property="rgtrId" column="rgtr_id"/> 	
	 	<result property="rgtDtm" column="rgt_dtm"/>
	 	<result property="updrId" column="updr_Id"/>
	 	<result property="updDtm" column="upd_Dtm"/>
	 </resultMap>

	<!-- 게시글을 저장 한다.  -->		 
	<insert id="boardInsert_001" parameterType="BoardVO">
		INSERT INTO /* CmDAO.boardInsert_001*/
		IRCMBOARD (
		IDX
		,BOARD_ID
		, TITLE
		, CONTENTS
		, DEL_YN
		, ATCH_YN
		, READ_CNT
		, RGTR_ID
		, RGT_DTM
		<if test="scrYn !=null">
		, SCR_YN
		, SCR_PW
		</if>
		) 
		values (
		#{idx}
		, #{boardId}
		, #{title}
		, #{contents}
		, 'N'
		, 'N'
		, 0
		, #{rgtId}
		, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
			<if test="scrYn !=null">
		, #{scrYn}
		, #{scrPw}
		</if>
		) 
		</insert>

	<!-- 게시글 내용을 업데이트 한다.  -->	
	<update id="boardUpdBoard_001" parameterType="BoardVO">
		UPDATE /*CmDAO.boardUpdBoard_001*/
		IRCMBOARD SET
		 TITLE = #{title}
		, CONTENTS = #{contents}
		, UPDR_ID= #{rgtId}
		, UPD_DTM = TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		<if test="scrYn !=null">
		, scrYn = #{scrYn}
		, scrPw = #{scrPw}
		</if>
		WHERE IDX = #{idx}
	</update>
	
	<!-- 게시글 MAX(글번호) 조회한다.  -->	
	<select id="selectBoardIdx_001" parameterType="BoardVO" resultType="Integer">
		SELECT /*CmDAO.selectBoardIdx_001*/
			NVL(MAX(IDX),0)+1
		FROM IRCMBOARD
	</select>
	

	<!-- 게시글 리스트를 조회한다.  -->	
	<select id="boardGetList_001" parameterType="BoardVO" resultMap="BoardVOarr" >
		SELECT /* CmDAO.boardGetList_001 */ * 
		FROM 
		( 
		SELECT ROWNUM NUM, 
			IDX,
			BOARD_ID,
			TITLE,
			CONTENTS,
			DEL_YN,
			ATCH_YN,
			READ_CNT,
			RGTR_ID,
			CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') = SUBSTR(RGT_DTM,0,8) 
        			  THEN  SUBSTR(RGT_DTM,-6,2)||':'||SUBSTR(RGT_DTM,-4,2) 
        			  ELSE SUBSTR(RGT_DTM,0,4)||'-'||SUBSTR(RGT_DTM,5,2)||'-'||SUBSTR(RGT_DTM,7,2)         			   
        			  END as RGT_DTM,
			SCR_YN,
			SCR_PW
		 FROM IRCMBOARD A
	<if test="srchKeyword != null">
		<where>
			<if test='srchtrg == "title"'>
			TITLE 
			</if>
			<if test='srchtrg == "contents"'>
			CONTENTS 
			</if>
			<![CDATA[
			  LIKE '%' + #{srchKeyword} +'%'
			]]>
 	  </where>
	 </if>
			 ORDER BY IDX DESC)
		WHERE NUM BETWEEN #{startIndex} AND #{pageSize} 
	</select>
	
	<!-- 게시글의 총갯수를 조회한다..  -->
	<select id="boardgetBoardCnt_001" parameterType="BoardVO" resultType="int">
		SELECT /*CmDAO.boardgetBoardCnt_001*/
		COUNT(*) 
		FROM IRCMBOARD
	</select>
	
	<!-- 게시글을 삭제한다.  -->	
	<delete id="boardDelete_001"  parameterType="BoardVO">
		DELETE   /* CmDAO.boardDelete_001*/
		FROM IRCMBOARD
		WHERE IDX=#{idx}
	</delete>
	
	<!-- 조회수를 업데이트한다.  -->
	<insert id="boardUpdateReadCnt_001" parameterType="int">
		UPDATE /* CmDAO.boardUpdateReadCnt_001 */
		IRCMBOARD
		SET READ_CNT = READ_CNT+1
		WHERE IDX=#{idx}
	</insert>
	
	<!-- 게시글을 상세 조회한다.  -->
	<select id="boardDetail_001" parameterType="BoardVO" resultMap="BoardVOarr">
			SELECT /* CmDAO.boardDetail_001*/
			IDX
			,BOARD_ID
			,TITLE
			,CONTENTS
			,DEL_YN
			,ATCH_YN
			,READ_CNT
			,RGTR_ID
			,RGT_DTM
			,UPDR_ID
			,UPD_DTM
			,SCR_YN
			,SCR_PW
		FROM IRCMBOARD
		WHERE IDX= #{idx}
	</select>
	
	<!-- 비밀글 갯수를 조회한다.  -->
	<select id="boardScrPwChkConfirm_001" parameterType="BoardVO" resultType="int">
	 SELECT /* CmDAO.boardScrPwChkConfirm_001 */
	 COUNT(*)
	 FROM IRCMBOARD
	 WHERE IDX= #{idx}
	 and SCR_PW= #{scrPw}
	
	</select>
<!-- 	<select id="boardSboard_001" parameterType="HashMap" resultMap="BoardVOarr">
			SELECT * /*boardSboard_001*/
			FROM board 
			WHERE 
			<if test="sel.equlas('title')">
			title like CONCAT('%',#{text},'%')
			</if>
			<if test="sel.equals('contents')">
			contents like CONCAT('%',#{text},'%')
			</if>
			ORDER BY IDX DESC
		
	
	</select> -->
	
	<!-- 공통 코드를 조회한다. -->
	<select id="selCmCode_001" parameterType="String" resultMap="CmCodearr">
		SELECT  /*CmDAO.selCmCode_001 */ 
		GNR_CD, GNR_CD_NM
		FROM IRCMCDDTL
		WHERE CD_ID = #{cdId}
		AND USE_YN='Y'
	</select>
	
	<!-- 공통 코드를 조회한다. -->
	<select id="selCmCode_002" parameterType="String" resultMap="CmCodearr">
		SELECT /* CmDAO.selCmCode_002 */ 
		GNR_CD, GNR_CD_NM
		FROM IRCMCDDTL
		WHERE CD_ID = #{cmId}
		AND USE_YN='Y'
	</select>
</mapper>
